# Claude/OpenAI API Proxy Configuration Example

# Server bind address (default: 0.0.0.0)
bind_address = "0.0.0.0"

# Server port (default: 8080)
port = 8080

# When using Claude official API
upstream_url = "https://api.anthropic.com"

# When using OpenAI official API
# upstream_url = "https://api.openai.com"

# When using Microsoft AI Foundry, you need to create a resource in Azure and deploy some models in the resource first.
# With this configuration, the proxy can handle both Claude and OpenAI compatible requests and forward them to the Microsoft AI Foundry service.
# upstream_url = "https://<your-resource-name>.services.ai.azure.com"

# API key that clients must provide to access this proxy
# This is the key your clients will use to authenticate with your proxy
client_api_key = "${DOWNSTREAM_API_KEY}"

# Upstream authentication configuration
# Choose ONE of the following options:

# Option 1: Direct API Key authentication
[upstream_auth]
type = "api_key"
api_key = "${UPSTREAM_API_KEY}"

## Below options are for Microsoft AI Foundry only, none of Claude or OpenAI official APIs support AAD or Azure CLI authentication.

# Option 2: Azure AD (Entra ID) authentication with client secret
# Uncomment and configure the following section to use Azure AD
# Supports environment variable expansion using ${VAR_NAME} or $VAR_NAME syntax
# [upstream_auth]
# type = "azure_ad"
# tenant_id = "${AZURE_TENANT_ID}"
# client_id = "${AZURE_CLIENT_ID}"
# client_secret = "${AZURE_CLIENT_SECRET}"
# # Default scope for Microsoft AI Foundry, no need to change
# scope = "https://ai.azure.com/.default"

# Option 3: Azure CLI credential authentication
# Uses the credentials from `az login` - no secrets needed in config
# Make sure you're logged in with: az login
# [upstream_auth]
# type = "azure_cli"
# # Default scope for Microsoft AI Foundry, no need to change
# scope = "https://ai.azure.com/.default"

# Option 4: Azure Managed Identity authentication
# For use on Azure VMs, App Services, Container Instances, etc. with managed identity enabled
# No secrets needed - uses the Azure Instance Metadata Service (IMDS)
# [upstream_auth]
# type = "azure_managed_identity"
# # Optional: client_id for user-assigned managed identity
# # If not specified, system-assigned managed identity is used
# # client_id = "your-user-assigned-identity-client-id"
# # Default resource for Microsoft AI Foundry, no need to change
# resource = "https://ai.azure.com/.default"

# Logging configuration (optional)
# If this section is omitted, logs are written to stdout only at INFO level
[logging]
# Directory for log files. If not set, logs go to stdout only.
# log_path = "/var/log/claude-proxy"

# Log rotation frequency: "hourly" or "daily" (default: "daily")
rotation = "daily"

# Log level: "trace", "debug", "info", "warn", "error" (default: "info")
# Note: The --verbose CLI flag overrides this to "debug"
level = "info"

# Prefix for log file names (default: "claude-proxy")
# Log files will be named like: claude-proxy.2024-01-15.log
log_prefix = "claude-proxy"

# TLS Configuration (optional)
# If this section is omitted, the proxy runs in HTTP-only mode
# Choose ONE of the following TLS options:

# Option 1: TLS Disabled (default)
# No [tls] section needed, or explicitly:
# [tls]
# mode = "disabled"

# Option 2: Manual TLS with your own certificate files
# Use this when you have pre-provisioned certificates (e.g., from your CA)
# [tls]
# mode = "manual"
# cert_path = "/etc/ssl/certs/proxy.pem"
# key_path = "/etc/ssl/private/proxy.key"
# https_port = 443  # Default: 443

# Option 3: Automatic TLS via ACME (Let's Encrypt)
# Automatically provisions and renews certificates from Let's Encrypt
# Requirements:
# - Port 80 must be accessible from the internet for HTTP-01 challenges
# - DNS must point to this server for all configured domains
# [tls]
# mode = "acme"
# email = "admin@example.com"
# domains = ["proxy.example.com", "api.example.com"]
# # Use staging for testing (avoids rate limits):
# # directory_url = "https://acme-staging-v02.api.letsencrypt.org/directory"
# # Default: Let's Encrypt production
# directory_url = "https://acme-v02.api.letsencrypt.org/directory"
# # Directory to store ACME account and certificates
# cache_dir = "/var/lib/claude-proxy/acme"
# https_port = 443           # Default: 443
# http_challenge_port = 80   # Default: 80 (for HTTP-01 domain validation)